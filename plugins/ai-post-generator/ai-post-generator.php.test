<?php
/**
 * Plugin Name: AI Post Generator - Versão Teste
 * Description: Versão mínima para testar sintaxe
 * Version: 2.0.0-test
 */

if (!defined('ABSPATH')) {
    exit;
}

define('AIPG_VERSION', '2.0.0');
define('AIPG_PLUGIN_DIR', plugin_dir_path(__FILE__));
define('AIPG_PLUGIN_URL', plugin_dir_url(__FILE__));

class AI_Post_Generator_Test {
    
    private static $instance = null;
    
    public static function get_instance() {
        if (null === self::$instance) {
            self::$instance = new self();
        }
        return self::$instance;
    }
    
    private function __construct() {
        add_action('admin_menu', array($this, 'add_admin_menu'));
        add_action('wp_ajax_aipg_test', array($this, 'ajax_test'));
    }
    
    public function add_admin_menu() {
        add_menu_page(
            'AI Post Test',
            'AI Test',
            'manage_options',
            'ai-post-test',
            array($this, 'render_test_page'),
            'dashicons-yes',
            30
        );
    }
    
    public function render_test_page() {
        ?>
        <div class="wrap">
            <h1>✅ Plugin Funcionando!</h1>
            <p>Se você está vendo esta página, a sintaxe básica está correta.</p>
            <button onclick="testAjax()" class="button button-primary">Testar AJAX</button>
            <div id="result"></div>
            
            <script>
            function testAjax() {
                fetch('<?php echo admin_url('admin-ajax.php'); ?>', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: 'action=aipg_test&nonce=<?php echo wp_create_nonce('aipg_test'); ?>'
                })
                .then(r => r.json())
                .then(data => {
                    document.getElementById('result').innerHTML = 
                        '<p style="color:green">✅ AJAX funcionando: ' + data.data.message + '</p>';
                })
                .catch(e => {
                    document.getElementById('result').innerHTML = 
                        '<p style="color:red">❌ Erro: ' + e + '</p>';
                });
            }
            </script>
        </div>
        <?php
    }
    
    public function ajax_test() {
        check_ajax_referer('aipg_test', 'nonce');
        wp_send_json_success(array('message' => 'AJAX está funcionando!'));
    }
}

// Inicializa
function aipg_test_init() {
    return AI_Post_Generator_Test::get_instance();
}
add_action('plugins_loaded', 'aipg_test_init');
?>